pull_request_rules:
  - name: Ping PR author when conflicting
    description: Warn the pull request author when their PR are conflicting
    conditions:
      - conflict
      - -closed
    actions:
      comment:
        message: >
          ðŸ‘‹ {{author}} your PR is conflicting and needs to be updated to be
          merged
  - name: Automatic squash and merge when CI passes and reviews approve
    conditions:
      - base=main
      - check-success=DCO
      - check-success=Shellcheck
      - check-success=Lint
      - check-success=Codegen
      - check-success=Go build
      - "#approved-reviews-by >= 1"
      - label=auto-squash
      - -label=wip
      - -label=do-not-merge/hold
    actions:
      merge:
        method: squash
  - name: Rebase pull request when it's more than 3 commits behind main
    conditions:
      - base = main
      - "#commits-behind >= 3"
    actions:
      rebase:
  - name: Add a label auto-squash to the PR automatically
    conditions: []
    actions:
      label:
        add:
          - auto-squash
merge_protections:
  - name: Enforce conventional commit
    description: Make sure that we follow https://www.conventionalcommits.org/en/v1.0.0/
    if:
      - base = main
    success_conditions:
      - "title ~= ^(\\[wip\\]|\\[backport\\]|\\[cherry-pick\\])?(
        )?(fix|feat|docs|style|refactor|perf|test|build|ci|chore|revert)(?:\\(.+\
        \\))?:"
